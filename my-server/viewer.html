<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CodeGuessr ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
        }
        body {
            font-family: 'Segoe UI', 'Courier New', monospace;
            background: #f0f0f0;  /* —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞, –∫–∞–∫ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ */
            color: #000;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.2rem;
            color: #111;
        }
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            color: #333;
        }
        .info-panel {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            background: #fff;
            padding: 0.5rem 2rem;
            border-radius: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .info-item {
            display: flex;
            gap: 0.5rem;
        }
        .info-label {
            color: #666;
        }
        .info-value {
            color: #0066cc;
            font-weight: bold;
        }
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å—Ç–∏–ª–µ –±–ª–æ–∫–Ω–æ—Ç–∞ */
        .notepad {
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px 0 10px 0;
            border-radius: 8px;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            font-family: 'Consolas', 'Cascadia Code', 'Courier New', monospace;
            font-size: 1.4rem;
            line-height: 1.5;
            background: white;
            margin: 0 auto;
        }
        td {
            padding: 0 0.2rem;
            white-space: pre;
        }
        /* –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ */
        .line-numbers {
            color: #2b91af;      /* —Å–∏–Ω–∏–π, –∫–∞–∫ –≤ Visual Studio */
            text-align: right;
            padding: 0 0.8rem 0 1.2rem;
            border-right: 1px solid #ccc;
            background: #f9f9f9;
            font-weight: normal;
        }
        /* –Ø—á–µ–π–∫–∏ —Å –∫–æ–¥–æ–º */
        .code-cell {
            color: black;
            min-width: 1.8rem;
            text-align: center;
            background: white;
            border: none;
        }
        .code-cell.highlight-center {
            background: #e6f3ff;
            border: 2px solid #1e90ff;
            border-radius: 3px;
        }
        .controls {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }
        button {
            background: #e0e0e0;
            color: #000;
            border: 1px solid #aaa;
            font-size: 2rem;
            width: 70px;
            height: 70px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.1s;
            box-shadow: 0 3px 0 #888;
        }
        button:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #888;
        }
        button:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #888;
        }
        .footer {
            margin-top: 1.5rem;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <h1>üìÑ CodeGuessr</h1>
    <div class="subtitle">—Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ 9√ó9 (–∫–∞–∫ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ)</div>

    <div class="info-panel">
        <div class="info-item"><span class="info-label">–¶–µ–Ω—Ç—Ä:</span><span class="info-value" id="coords">5:5</span></div>
        <div class="info-item"><span class="info-label">–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫:</span><span class="info-value" id="totalRows">?</span></div>
    </div>

    <div class="notepad">
        <table id="code-grid">
            <!-- –ó–¥–µ—Å—å JavaScript —Å–æ–∑–¥–∞—Å—Ç —Å—Ç—Ä–æ–∫–∏ -->
        </table>
    </div>

    <div class="controls">
        <button id="up">‚Üë</button>
        <button id="left">‚Üê</button>
        <button id="down">‚Üì</button>
        <button id="right">‚Üí</button>
    </div>

    <div class="footer">‚Üê ‚Üë ‚Üí ‚Üì –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ ‚Ä¢ —Ü–µ–Ω—Ç—Ä –≤—ã–¥–µ–ª–µ–Ω —Å–∏–Ω–µ–π —Ä–∞–º–∫–æ–π</div>

    <script>
        const WINDOW_SIZE = 9;
        const HALF = 4; // (9-1)/2

        let currentRow = 5;
        let currentCol = 5;
        let totalRows = 0;

        const gridElement = document.getElementById('code-grid');

        // –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É 9x9 + —Å—Ç–æ–ª–±–µ—Ü —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫
        function buildGrid() {
            let html = '';
            for (let r = 0; r < WINDOW_SIZE; r++) {
                html += '<tr>';
                // –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ (–±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
                html += `<td class="line-numbers" id="line-${r}">${r + 1}</td>`;
                // –Ø—á–µ–π–∫–∏ —Å —Å–∏–º–≤–æ–ª–∞–º–∏
                for (let c = 0; c < WINDOW_SIZE; c++) {
                    html += `<td class="code-cell" id="cell-${r}-${c}"> </td>`;
                }
                html += '</tr>';
            }
            gridElement.innerHTML = html;
        }
        buildGrid();

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ç–∫—É –¥–∞–Ω–Ω—ã–º–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function fetchWindow(row, col) {
            const url = `/api/window?row=${row}&col=${col}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                const data = await response.json();
                updateGrid(data.window);
                document.getElementById('coords').innerText = `${data.centerRow}:${data.centerCol}`;
                document.getElementById('totalRows').innerText = data.totalRows;
                totalRows = data.totalRows;
            } catch (err) {
                console.error(err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
            }
        }

        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —è—á–µ–π–∫–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫
        function updateGrid(windowMatrix) {
            // –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ (–æ–Ω–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞)
            for (let r = 0; r < WINDOW_SIZE; r++) {
                const lineNumberEl = document.getElementById(`line-${r}`);
                const fileRow = currentRow - HALF + r; // —Å—Ç—Ä–æ–∫–∞ –≤ —Ñ–∞–π–ª–µ (1‚Äë–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)
                if (fileRow >= 1 && fileRow <= totalRows) {
                    lineNumberEl.textContent = fileRow;
                } else {
                    lineNumberEl.textContent = '¬∑'; // –∑–∞ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ñ–∞–π–ª–∞
                }
            }

            // –û–±–Ω–æ–≤–∏—Ç—å —Å–∏–º–≤–æ–ª—ã
            for (let r = 0; r < WINDOW_SIZE; r++) {
                for (let c = 0; c < WINDOW_SIZE; c++) {
                    const cell = document.getElementById(`cell-${r}-${c}`);
                    const ch = windowMatrix[r][c];
                    // –ü—Ä–æ–±–µ–ª –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º (–∏–ª–∏ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å ¬∑ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏, –Ω–æ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ –ø—Ä–æ–±–µ–ª –Ω–µ–≤–∏–¥–∏–º)
                    cell.textContent = ch === ' ' ? ' ' : ch;
                    cell.classList.remove('highlight-center');
                }
            }
            // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —è—á–µ–π–∫—É
            document.getElementById(`cell-${HALF}-${HALF}`).classList.add('highlight-center');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('up').addEventListener('click', () => {
            currentRow = Math.max(1, currentRow - 1);
            fetchWindow(currentRow, currentCol);
        });
        document.getElementById('down').addEventListener('click', () => {
            currentRow = currentRow + 1;
            fetchWindow(currentRow, currentCol);
        });
        document.getElementById('left').addEventListener('click', () => {
            currentCol = Math.max(1, currentCol - 1);
            fetchWindow(currentRow, currentCol);
        });
        document.getElementById('right').addEventListener('click', () => {
            currentCol = currentCol + 1;
            fetchWindow(currentRow, currentCol);
        });

        // –ö–ª–∞–≤–∏—à–∏-—Å—Ç—Ä–µ–ª–∫–∏
        window.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    currentRow = Math.max(1, currentRow - 1);
                    fetchWindow(currentRow, currentCol);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    currentRow = currentRow + 1;
                    fetchWindow(currentRow, currentCol);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    currentCol = Math.max(1, currentCol - 1);
                    fetchWindow(currentRow, currentCol);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    currentCol = currentCol + 1;
                    fetchWindow(currentRow, currentCol);
                    break;
            }
        });

        // –°—Ç–∞—Ä—Ç
        fetchWindow(currentRow, currentCol);
    </script>
</body>
</html>